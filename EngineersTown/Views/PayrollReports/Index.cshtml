@{
    ViewData["Title"] = "Payroll Reports";
    var availablePeriods = ViewBag.AvailablePeriods as IEnumerable<dynamic>;
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-file-invoice-dollar"></i> Payroll Reports
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Generate New Report -->
                        <div class="col-md-6">
                            <div class="card card-primary">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Generate Payroll Report</h5>
                                </div>
                                <div class="card-body">
                                    <form asp-action="GenerateReport" method="post" class="form-inline">
                                        <div class="form-group mr-3">
                                            <label for="month" class="mr-2">Month:</label>
                                            <select name="month" id="month" class="form-control" required>
                                                @for (int i = 1; i <= 12; i++)
                                                {
                                                    var monthName = new DateTime(2000, i, 1).ToString("MMMM");
                                                    <option value="@i" selected="@(i == DateTime.Now.Month)">
                                                        @monthName
                                                    </option>
                                                }
                                            </select>

                                        </div>
                                        <div class="form-group mr-3">
                                            <label for="year" class="mr-2">Year:</label>
                                            <select name="year" id="year" class="form-control" required>
                                                @for (int year = DateTime.Now.Year - 2; year <= DateTime.Now.Year + 1; year++)
                                                {
                                                    <option value="@year" selected="@(year == DateTime.Now.Year)">
                                                        @year
                                                    </option>
                                                }
                                            </select>

                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-calculator"></i> Generate Report
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Available Reports -->
                        <div class="col-md-6">
                            <div class="card card-info">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Available Reports</h5>
                                </div>
                                <div class="card-body">
                                    @if (availablePeriods != null && availablePeriods.Any())
                                    {
                                        <div class="list-group">
                                            @foreach (var period in availablePeriods.Take(10))
                                            {
                                                var monthName = new DateTime(period.Year, period.Month, 1).ToString("MMMM yyyy");
                                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                                    <span>@monthName</span>
                                                    <div class="btn-group btn-group-sm" role="group">
                                                        <a href="@Url.Action("ViewReport", new { month = period.Month, year = period.Year })" 
                                                           class="btn btn-outline-primary btn-sm">
                                                            <i class="fas fa-eye"></i> View
                                                        </a>
                                                        <a href="@Url.Action("Print", new { month = period.Month, year = period.Year })" 
                                                           class="btn btn-outline-success btn-sm" target="_blank">
                                                            <i class="fas fa-print"></i> Print
                                                        </a>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                        
                                        @if (availablePeriods.Count() > 10)
                                        {
                                            <p class="text-muted mt-2">Showing latest 10 reports...</p>
                                        }
                                    }
                                    else
                                    {
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle"></i>
                                            No payroll reports generated yet. Generate your first report above.
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card card-warning">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Quick Actions</h5>
                                </div>
                                <div class="card-body">
                                    <div class="btn-group" role="group">
                                        <form method="post" asp-action="GenerateReport" asp-controller="PayrollReports" style="display:inline;">
                                            <input type="hidden" name="month" value="@DateTime.Now.Month" />
                                            <input type="hidden" name="year" value="@DateTime.Now.Year" />
                                            <button type="submit" class="btn btn-warning">
                                                <i class="fas fa-calendar-alt"></i> Current Month Report
                                            </button>
                                        </form>

                                        <form method="post" asp-action="GenerateReport" asp-controller="PayrollReports" style="display:inline;">
                                            <input type="hidden" name="month" value="@DateTime.Now.AddMonths(-1).Month" />
                                            <input type="hidden" name="year" value="@DateTime.Now.AddMonths(-1).Year" />
                                            <button type="submit" class="btn btn-secondary">
                                                <i class="fas fa-calendar-minus"></i> Previous Month Report
                                            </button>
                                        </form>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Auto-submit form for quick actions
            $('.quick-action').click(function(e) {
                e.preventDefault();
                var month = $(this).data('month');
                var year = $(this).data('year');
                $('#month').val(month);
                $('#year').val(year);
                $('form').submit();
            });
        });
    </script>
}