@model Employee

@{
    ViewData["Title"] = "Edit Employee";
}

<div class="w-full py-6">
    <div class="flex justify-center">
        <div class="w-full max-w-4xl">
            <div class="bg-white rounded-lg shadow-sm border-0">
                <div class="bg-gradient-to-r from-primary-700 to-primary-600 text-white py-4 px-6 rounded-t-lg">
                    <h3 class="text-xl font-semibold mb-0">
                        <i class="fas fa-user-edit mr-2"></i>
                        Edit Employee
                    </h3>
                </div>

                <div class="p-6">
                    <form asp-action="Edit" id="employeeForm">
                        @* Hidden ID field for model binding *@
                        <input type="hidden" asp-for="Id" />

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label asp-for="Name" class="block text-sm font-semibold text-gray-700 mb-2"></label>
                                    <input asp-for="Name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200" />
                                    <span asp-validation-for="Name" class="text-red-600 text-sm mt-1 block"></span>
                                </div>

                                <div>
                                    <label asp-for="ZkedID" class="block text-sm font-semibold text-gray-700 mb-2"></label>
                                    <input asp-for="ZkedID" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200" />
                                    <span asp-validation-for="ZkedID" class="text-red-600 text-sm mt-1 block"></span>
                                </div>

                                <div>
                                    <label asp-for="CNIC" class="block text-sm font-semibold text-gray-700 mb-2"></label>
                                    <input asp-for="CNIC" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200" />
                                    <span asp-validation-for="CNIC" class="text-red-600 text-sm mt-1 block"></span>
                                </div>

                                <div>
                                    <label asp-for="DOB" class="block text-sm font-semibold text-gray-700 mb-2"></label>
                                    <input asp-for="DOB" type="date" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200" />
                                    <span asp-validation-for="DOB" class="text-red-600 text-sm mt-1 block"></span>
                                </div>
                            </div>

                                <div>
                                    <label asp-for="DepartmentId" class="block text-sm font-semibold text-gray-700 mb-2"></label>
                                    <select asp-for="DepartmentId" asp-items="ViewBag.DepartmentId" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200" id="departmentSelect">
                                        <option value="">-- Select Department --</option>
                                    </select>
                                    <span asp-validation-for="DepartmentId" class="text-red-600 text-sm mt-1 block"></span>
                                </div>

                                <div>
                                    <label asp-for="DesignationId" class="block text-sm font-semibold text-gray-700 mb-2"></label>
                                    <select asp-for="DesignationId" asp-items="ViewBag.DesignationId" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200" id="designationSelect">
                                        <option value="">-- Select Designation --</option>
                                    </select>
                                    <span asp-validation-for="DesignationId" class="text-red-600 text-sm mt-1 block"></span>
                                </div>

                                <div>
                                    <label asp-for="Type" class="block text-sm font-semibold text-gray-700 mb-2"></label>
                                    <select asp-for="Type" asp-items="ViewBag.EmployeeTypes" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200" id="Type">
                                        <option value="">-- Select Type --</option>
                                    </select>
                                    <span asp-validation-for="Type" class="text-red-600 text-sm mt-1 block"></span>
                                </div>

                                <div id="contractExpiryGroup" style="display: none;">
                                    <label asp-for="ContractExpiryDate" class="block text-sm font-semibold text-gray-700 mb-2"></label>
                                    <input asp-for="ContractExpiryDate" type="date" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200" />
                                    <span asp-validation-for="ContractExpiryDate" class="text-red-600 text-sm mt-1 block"></span>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-3 mt-8">
                            <button type="submit" class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-md font-medium transition-colors duration-200 transform hover:-translate-y-0.5">
                                <i class="fas fa-save mr-2"></i> Save Changes
                            </button>
                            <a asp-action="Index" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-md font-medium transition-colors duration-200 transform hover:-translate-y-0.5">
                                <i class="fas fa-arrow-left mr-2"></i> Back to List
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Load designations when department changes
            $('#departmentSelect').change(function () {
                var departmentId = $(this).val();
                if (departmentId) {
                    $.getJSON('/Employee/GetDesignationsByDepartment', { departmentId: departmentId }, function (data) {
                        $('#designationSelect').empty().append('<option value="">-- Select Designation --</option>');
                        $.each(data, function (i, item) {
                            $('#designationSelect').append($('<option>', {
                                value: item.id,
                                text: item.name
                            }));
                        });

                        // Set previously selected designation
                        var selectedDesignationId = '@Model.DesignationId';
                        $('#designationSelect').val(selectedDesignationId);
                    });
                } else {
                    $('#designationSelect').empty().append('<option value="">-- Select Designation --</option>');
                }
            });

            // Show/hide contract expiry date based on employee type
            $('#Type').change(function () {
                if ($(this).val() === '002') {
                    $('#contractExpiryGroup').show();
                } else {
                    $('#contractExpiryGroup').hide();
                }
            });

            // Trigger change to load dependent values on page load
            $('#departmentSelect').trigger('change');
            $('#Type').trigger('change');
        });
    </script>
}
