@model EngineersTown.Models.ViewModels.PayrollReportViewModel

@{
    ViewData["Title"] = "Payroll Report";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Payroll Report</h1>
    <div>
        <a href="@Url.Action("PrintReport", new { payrollMonth = Model.PayrollMonth, departmentId = Model.DepartmentId })"
           class="btn btn-success" target="_blank">Print Report</a>
    </div>
</div>

<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label for="PayrollMonth" class="form-label">Payroll Month</label>
                <input type="month" class="form-control" id="PayrollMonth" name="payrollMonth"
                       value="@Model.PayrollMonth.ToString("yyyy-MM")">
            </div>
            <div class="col-md-3">
                <label for="DepartmentId" class="form-label">Department</label>
                <select class="form-select" id="DepartmentId" name="departmentId">
                    <option value="">All Departments</option>
                    @foreach (var dept in Model.Departments)
                    {
                        <option value="@dept.Value" selected="@(dept.Value == Model.DepartmentId?.ToString())">@dept.Text</option>
                    }
                </select>
            </div>
            <div class="col-md-3 align-self-end">
                <button type="submit" class="btn btn-primary">Generate Report</button>
                <a href="@Url.Action("Index")" class="btn btn-secondary">Reset</a>
            </div>
        </form>
    </div>
</div>

@if (Model.DepartmentReports.Any())
{
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">Payroll Summary for @Model.PayrollMonth.ToString("MMMM yyyy")</h5>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <h6 class="card-title">Total Employees</h6>
                            <h3 class="text-primary">@Model.Summary.TotalEmployees</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <h6 class="card-title">Total Gross</h6>
                            <h3 class="text-success">@Model.Summary.TotalGross.ToString("C")</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <h6 class="card-title">Total Deductions</h6>
                            <h3 class="text-danger">@Model.Summary.TotalDeductions.ToString("C")</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <h6 class="card-title">Total Net</h6>
                            <h3 class="text-info">@Model.Summary.TotalNet.ToString("C")</h3>
                        </div>
                    </div>
                </div>
            </div>

            @foreach (var department in Model.DepartmentReports)
            {
                <div class="department-section mb-5">
                    <h4 class="mb-3">@department.DepartmentName</h4>

                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th>Employee</th>
                                    <th>Type</th>
                                    <th>Designation</th>
                                    <th>Basic Salary</th>
                                    <th>Allowances</th>
                                    <th>Gross Salary</th>
                                    <th>Deductions</th>
                                    <th>Net Payable</th>
                                    <th>Attendance</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var employee in department.Employees)
                                {
                                    <tr>
                                        <td>@employee.EmployeeName</td>
                                        <td>@employee.EmployeeType</td>
                                        <td>@employee.DesignationName</td>
                                        <td>@employee.BasicSalary.ToString("C")</td>
                                        <td>@employee.Allowances.ToString("C")</td>
                                        <td>@employee.GrossSalary.ToString("C")</td>
                                        <td>@employee.TotalDeductions.ToString("C")</td>
                                        <td>@employee.NetPayable.ToString("C")</td>
                                        <td>@employee.PresentDays/@employee.TotalWorkingDays</td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot class="table-secondary">
                                <tr>
                                    <td colspan="5" class="text-end"><strong>Department Total:</strong></td>
                                    <td><strong>@department.DepartmentGrossTotal.ToString("C")</strong></td>
                                    <td><strong>@department.DepartmentDeductionsTotal.ToString("C")</strong></td>
                                    <td><strong>@department.DepartmentNetTotal.ToString("C")</strong></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            }
        </div>
    </div>
}
else
{
    <div class="alert alert-info">
        No payroll data found for the selected criteria.
    </div>
}